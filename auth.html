<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login / Register - Shreeram Computers</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f4f4f9; }
    header { background:#2c3e50; color:#fff; padding:15px; text-align:center; font-size:1.4em; }
    .wrap { max-width:420px; margin:20px auto; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:20px; }
    h2 { margin:0 0 10px 0; font-size:1.2em; }
    label { display:block; margin:10px 0 5px; font-weight:bold; }
    input { width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; }
    button { margin-top:12px; width:100%; padding:10px; border:none; border-radius:6px; background:#2c3e50; color:#fff; cursor:pointer; font-size:1em; }
    .alt { margin-top:8px; background:#007bff; }
    .msg { margin-top:10px; color:#e74c3c; min-height:20px; }
    .hint { font-size:0.9em; color:#666; margin-top:10px; }
    .links { text-align:center; margin-top:12px; }
    .links a { color:#007bff; text-decoration:none; }
  </style>
  <script type="module">
    import { registerWithEmailPassword, loginWithEmailPassword, observeAuth, auth, db, serverTimestamp } from './firebase-config.js';

    window.addEventListener('DOMContentLoaded', () => {
      observeAuth(user => {
        if (user) {
          const redirect = sessionStorage.getItem('postLoginRedirect') || 'index.html';
          sessionStorage.removeItem('postLoginRedirect');
          window.location.href = redirect;
        }
      });

      let isLoginMode = true;
      const form = document.getElementById('authForm');
      const msg = document.getElementById('msg');
      const toggleMode = document.getElementById('toggleMode');
      const formTitle = document.getElementById('formTitle');
      const submitBtn = document.getElementById('submitBtn');
      const registerFields = document.getElementById('registerFields');
      const toggleText = document.getElementById('toggleText');

      toggleMode.addEventListener('click', (e) => {
        e.preventDefault();
        isLoginMode = !isLoginMode;
        if (isLoginMode) {
          formTitle.textContent = 'Login';
          submitBtn.textContent = 'Sign In';
          toggleText.textContent = 'New here?';
          toggleMode.textContent = 'Create Account';
          registerFields.style.display = 'none';
        } else {
          formTitle.textContent = 'Register';
          submitBtn.textContent = 'Create Account';
          toggleText.textContent = 'Already have an account?';
          toggleMode.textContent = 'Sign In';
          registerFields.style.display = 'block';
        }
        msg.textContent = '';
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = '';
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('password').value;
        
        try {
          if (isLoginMode) {
            await loginWithEmailPassword(email, pass);
          } else {
            const fullName = document.getElementById('fullName').value.trim();
            const mobile = document.getElementById('mobileNumber').value.trim();
            await registerWithEmailPassword(email, pass);
            // Save additional user data to Firestore
            if (fullName || mobile) {
              const { doc, setDoc } = await import('https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js');
              const user = auth.currentUser;
              if (user) {
                await setDoc(doc(db, 'users', user.uid), {
                  fullName: fullName || '',
                  mobileNumber: mobile || '',
                  email: email,
                  createdAt: serverTimestamp()
                }, { merge: true });
              }
            }
          }
        } catch (err) { 
          msg.textContent = err.message; 
        }
      });
    });
  </script>
</head>
<body>
  <header>Login / Register</header>
  <div class="wrap">
    <h2 id="formTitle">Login</h2>
    <form id="authForm">
      <div id="registerFields" style="display:none;">
        <label>Full Name</label>
        <input type="text" id="fullName" placeholder="Enter your full name">
        <label>Mobile Number</label>
        <input type="tel" id="mobileNumber" placeholder="Enter your mobile number">
      </div>
      
      <label>Email</label>
      <input type="email" id="email" required>
      <label>Password</label>
      <input type="password" id="password" required minlength="6">
      
      <button type="submit" id="submitBtn">Sign In</button>
    </form>

    <div class="hint">
      <span id="toggleText">New here?</span>
      <a href="#" id="toggleMode">Create Account</a>
    </div>

    <div id="msg" class="msg"></div>
    <div class="links"><a href="index.html">‚Üê Back to Home</a></div>
  </div>
</body>
</html>


