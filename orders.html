<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Orders - Shreeram Computers</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f9f9f9; padding-bottom:70px; }
    header { background:#222; color:#fff; padding:15px; text-align:center; font-size:20px; }
    .container { padding:15px; }
    .order { background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:12px; padding:12px; }
    .order-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .order-items { display:grid; grid-template-columns:repeat(auto-fill, minmax(160px, 1fr)); gap:10px; }
    .item { background:#fafafa; border:1px solid #eee; border-radius:8px; padding:8px; text-align:center; }
    .item img { width:80px; height:80px; object-fit:contain; }
    .price { color:green; font-weight:bold; }
    nav { position:fixed; bottom:0; left:0; width:100%; background:#222; display:flex; justify-content:space-around; padding:10px 0; }
    nav a { color:#fff; text-decoration:none; text-align:center; font-size:14px; }
    .empty { color:#666; text-align:center; margin-top:30px; }
  </style>
  <script type="module">
    import { observeAuth, fetchUserOrders } from './firebase-config.js';

    function formatINR(n){ return '‚Çπ' + Number(n || 0).toLocaleString('en-IN'); }
    function formatDate(ts){ try { return ts && ts.toDate ? ts.toDate().toLocaleString() : ''; } catch(e){ return ''; } }

    let currentUser = null;
    observeAuth(async (user) => {
      currentUser = user;
      if(!user){
        sessionStorage.setItem('postLoginRedirect', 'orders.html');
        window.location.href = 'auth.html';
        return;
      }
      await renderOrders();
    });

    async function renderOrders(){
      const container = document.getElementById('orders');
      container.innerHTML = '';
      const orders = await fetchUserOrders(currentUser);
      if(!orders.length){
        container.innerHTML = '<div class="empty">No orders yet.</div>';
        return;
      }
      orders.forEach(o => {
        const itemsHtml = (o.items || []).map(it => `
          <div class="item">
            <img src="${it.image || 'https://via.placeholder.com/80'}" alt="${it.name}">
            <div>${it.name}</div>
            <div>Qty: ${it.qty}</div>
            <div class="price">${formatINR(it.price)}</div>
          </div>
        `).join('');
        container.innerHTML += `
          <div class="order">
            <div class="order-header">
              <div>Order ID: ${o.id}</div>
              <div>${formatDate(o.createdAt)}</div>
              <div class="price">Total: ${formatINR(o.total)}</div>
            </div>
            <div class="order-items">${itemsHtml}</div>
          </div>
        `;
      });
    }
  </script>
</head>
<body>
  <header>üì¶ My Orders</header>
  <div class="container" id="orders"></div>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="categories.html">üìÇ Categories</a>
    <a href="sale.html">üí∞ Sale</a>
    <a href="profile.html">üë§ Profile</a>
  </nav>
</body>
</html>


